<% layout("/layouts/boilerplate")%>
<style>
    @media(max-width:640px){
        body{
            padding-top: 19rem;
        }
    }
</style>
<script>
const coordinates=<%-JSON.stringify(data.geometry.coordinates)%>//it's working
</script>
  <body>
    <div class="row showCard mt-4 mb-3">
        <h3>Listing Details</h3>
        <br>
        <h6>Owned by <%=data.owner.username%></h6>
         <div class=" listing-card col-5 ">
              <img src="<%=data.image.url%>" class="card-image-top" style="height: 20rem;">
              <div class="card-body">
                 <p><b><%=data.title%></b><br><br>
                    <%=data.description%><br> 
                    <%=data.category%>
                    &#8377;<%=data.price.toLocaleString("en-IN")%><br>
                    <p><b><%=data.country%></b></p>
                    <p><b><%=data.location%></b></p>
                    </p>
              </div>

         </div>
    </div >
   
    <div class="showbtn mb-3 ">
        <div class="editbtn me-5">
             <form method="get" action="/listings/edit/<%=data._id%>">
                  <button type="submit" class="btn btn-primary">EDIT</button>
             </form>
        </div>
        <div class="showdelbtn mb-3">
            <form method="post" action="/listings/delete/<%=data._id%>?_method=DELETE">
                <button type="submit" class="btn btn-danger">Delete</button>
            </form>
        </div>
    </div>
                                                       
    <!-- <h1><%=data.title%></h1>
    <h3><%=data.description%></h3>
    <h3> &#8377;<%=data.price.toLocaleString("en-IN")%></h3>
    <h3><%=data.location%></h3>
    <h3><%=data.country%></h3>
    <form method="get" action="/listings/edit/<%=data._id%>">
        <button type="submit">EDIT</button>
    </form>
    <form method="post" action="/listings/delete/<%=data._id%>?_method=DELETE">
        <button type="submit">Delete</button>
    </form> -->
    <%if(currentUser){%>
    <div class="col-8 offset-2" class="mt-3">
        <h4>Leave a Review</h4>
        <form method="post" action="/listings/<%=data.id%>/reviews" class="needs-validation" novalidate >
            <!-- <div class="mb-3"  style="border: none;">
                <label for="rating">Rating</label>
                <input type="range" min="1" max="5" id="rating" name="review[rating]" class="form-control form-range"  style="border: none;" required>
            </div> -->
            <fieldset class="starability-slot">
                
                
                 <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                 <label for="first-rate1" title="Terrible">1 star</label>
                 <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                 <label for="first-rate2" title="Not good">2 stars</label>
                 <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                 <label for="first-rate3" title="Average">3 stars</label>
                 <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                 <label for="first-rate4" title="Very good">4 stars</label>
                 <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                 <label for="first-rate5" title="Amazing">5 stars</label>
             </fieldset>
            <div class="mb-3">
                <label for="comment">Comments</label>
                <textarea name="review[comment]" id="comment" cols="20" rows="7" class="form-control"  required></textarea>
                 <div class="invalid-feedback">please share your exprience</div>
            </div>
            <button class=" btn btn-outline-dark mb-3 " type="submit">Submit</button>
        </form>
       </div>
 </div> <% }%>
   <div class="row mb-3 justify-content-center"><P class="offset-1"><b>WHERE YOU WILL BE</b></P>
        <div id="map" class="col-6  ms-2"></div>
   </div>
 <%if(data.reviews.length>0){%>
 <h5 class="offset-1">All Reviews</h5>
 <div class="row justify-content-center ">
       <% for(review of data.reviews) {%>
         
           <div class="card col-10 col-md-5 ms-2 mb-4 offset-2" style="border: 2px solid gainsboro;">
              <div class="card-body">
                   <h6><%=review.author.username%></h6>
                   <p class="starability-result" data-rating="<%=review.rating%>"></p>
                   <p><%=review.comment%></p>
                  
                 
  
              </div>
              <form action="/listings/<%=data._id%>/reviews/<%=review._id%>?_method=DELETE" method="post">
              <button type="submit" class=" btn btn-dark btn-sm mb-3 ms-3 " style="display: inline-block;">DELETE</button>
              </form>
           </div>
           
     <%}%>
     </div>
   <% }%>
   <!-- <div class="row mb-3">
        <div id="map" class="col-6 offset-2"></div>
   </div> -->
 </div> 
</body>
<script>// whole script for map use
    let mapToken="<%=process.env.MAP_TOKEN%>";
    mapboxgl.accessToken = mapToken;
   
    const map = new mapboxgl.Map({
        container: 'map', // container ID
        center: coordinates, // starting position [lng, lat]. Note that lat must be set between -90 and 90
        zoom: 9, // starting zoom
       
        });
          const marker=new mapboxgl.Marker({color:'red'})
          .setLngLat(coordinates)
          .addTo(map);
    
</script>

